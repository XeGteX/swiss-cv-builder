
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                 String   @id @default(uuid())
  email              String   @unique
  passwordHash       String
  role               String   @default("USER") // "USER" | "ADMIN"
  subscriptionStatus String   @default("FREE") // FREE, PRO
  aiUsageCount       Int      @default(0)
  quotaResetAt       DateTime @default(now())
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  profiles     Profile[]
  letters      Letter[]
  subscription Subscription?
}

model Profile {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  title  String  @default("My CV")
  isDemo Boolean @default(false)

  // Full CV data as JSON
  data String? // Storing the full JSON blob of the CV profile

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Letter {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  title         String
  content       String
  language      String  @default("en")
  targetJob     String?
  targetCompany String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Subscription {
  id     String @id @default(uuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  stripeCustomerId     String?
  stripeSubscriptionId String?
  plan                 String  @default("FREE")
  status               String  @default("active")

  currentPeriodStart DateTime?
  currentPeriodEnd   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
